--[[
═══════════════════════════════════════════════════════════════════════════════
    VN.DEV UI LIBRARY - Dark Theme with Cyan Accents
    Reskinned from Rally UI to match VN.DEV v1.7 style
═══════════════════════════════════════════════════════════════════════════════
--]]

local Players = game:GetService('Players')
local RunService = game:GetService('RunService')
local UserInputService = game:GetService('UserInputService')
local TweenService = game:GetService('TweenService')
local HttpService = game:GetService('HttpService')

local VNDevUI = {}
VNDevUI.__index = VNDevUI

-- Theme Colors (VN.DEV Style)
local Theme = {
    Background = Color3.fromRGB(18, 18, 21),
    Sidebar = Color3.fromRGB(24, 24, 28),
    Header = Color3.fromRGB(24, 24, 28),
    Element = Color3.fromRGB(32, 32, 38),
    ElementHover = Color3.fromRGB(40, 40, 48),
    Input = Color3.fromRGB(45, 45, 52),
    Accent = Color3.fromRGB(75, 75, 85),
    AccentHover = Color3.fromRGB(90, 90, 100),
    Text = Color3.fromRGB(255, 255, 255),
    TextDim = Color3.fromRGB(140, 140, 150),
    TextMuted = Color3.fromRGB(100, 100, 110),
    TabActive = Color3.fromRGB(45, 45, 52),
    TabInactive = Color3.fromRGB(24, 24, 28),
    Toggle = Color3.fromRGB(55, 55, 65),
    ToggleEnabled = Color3.fromRGB(75, 75, 85),
    Keybind = Color3.fromRGB(50, 50, 58),
}

-- Config Management
local ConfigManager = {}
ConfigManager.__index = ConfigManager

function ConfigManager.new()
    local self = setmetatable({}, ConfigManager)
    self.configFolder = "VNDevConfigs"
    self.currentConfig = nil
    self.configs = {}
    
    if not isfolder(self.configFolder) then
        makefolder(self.configFolder)
    end
    
    return self
end

function ConfigManager:SaveConfig(configName, settings)
    local success, err = pcall(function()
        local configPath = self.configFolder .. "/" .. configName .. ".json"
        local data = HttpService:JSONEncode(settings)
        writefile(configPath, data)
        self.currentConfig = configName
    end)
    return success
end

function ConfigManager:LoadConfig(configName)
    local success, result = pcall(function()
        local configPath = self.configFolder .. "/" .. configName .. ".json"
        if isfile(configPath) then
            local data = readfile(configPath)
            return HttpService:JSONDecode(data)
        end
        return nil
    end)
    
    if success and result then
        self.currentConfig = configName
        return result
    end
    return nil
end

function ConfigManager:DeleteConfig(configName)
    local success, err = pcall(function()
        local configPath = self.configFolder .. "/" .. configName .. ".json"
        if isfile(configPath) then
            delfile(configPath)
            if self.currentConfig == configName then
                self.currentConfig = nil
            end
        end
    end)
    return success
end

function ConfigManager:GetConfigs()
    local configs = {}
    local success, err = pcall(function()
        if isfolder(self.configFolder) then
            for _, file in ipairs(listfiles(self.configFolder)) do
                local fileName = file:match("([^/\\]+)%.json$")
                if fileName then
                    table.insert(configs, fileName)
                end
            end
        end
    end)
    return configs
end

function ConfigManager:AutoLoad()
    local configs = self:GetConfigs()
    if #configs > 0 then
        return self:LoadConfig(configs[1])
    end
    return nil
end

-- Main UI
function VNDevUI:CreateWindow(config)
    config = config or {}
    local self = setmetatable({}, VNDevUI)

    self.WindowName = config.Name or 'VN.DEV'
    self.Version = config.Version or 'v1.7'
    self.Tabs = {}
    self.TabOrder = {}
    self.CurrentTab = nil
    self.Settings = {}
    self.ConfigManager = ConfigManager.new()

    self:CreateMainUI()
    self:BindToggleKey()
    
    task.spawn(function()
        task.wait(0.5)
        local loadedSettings = self.ConfigManager:AutoLoad()
        if loadedSettings then
            self:ApplySettings(loadedSettings)
            self:Notify("Config Auto-Loaded", "Loaded: " .. (self.ConfigManager.currentConfig or "Unknown"))
        end
    end)

    return self
end

function VNDevUI:CreateMainUI()
    self.ScreenGui = Instance.new('ScreenGui')
    self.ScreenGui.Name = 'VNDevUI'
    self.ScreenGui.ResetOnSpawn = false
    self.ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling
    self.ScreenGui.Parent = Players.LocalPlayer:WaitForChild('PlayerGui')

    -- Main Container
    self.MainFrame = Instance.new('Frame')
    self.MainFrame.Name = 'MainFrame'
    self.MainFrame.Size = UDim2.new(0, 750, 0, 500)
    self.MainFrame.Position = UDim2.new(0.5, -375, 0.5, -250)
    self.MainFrame.BackgroundColor3 = Theme.Background
    self.MainFrame.BorderSizePixel = 0
    self.MainFrame.ClipsDescendants = true
    self.MainFrame.Parent = self.ScreenGui

    local mainCorner = Instance.new('UICorner')
    mainCorner.CornerRadius = UDim.new(0, 8)
    mainCorner.Parent = self.MainFrame

    -- Header Bar
    self.HeaderBar = Instance.new('Frame')
    self.HeaderBar.Name = 'HeaderBar'
    self.HeaderBar.Size = UDim2.new(1, 0, 0, 50)
    self.HeaderBar.BackgroundColor3 = Theme.Header
    self.HeaderBar.BorderSizePixel = 0
    self.HeaderBar.Parent = self.MainFrame

    local headerCorner = Instance.new('UICorner')
    headerCorner.CornerRadius = UDim.new(0, 8)
    headerCorner.Parent = self.HeaderBar

    -- Fix bottom corners of header
    local headerFix = Instance.new('Frame')
    headerFix.Size = UDim2.new(1, 0, 0, 10)
    headerFix.Position = UDim2.new(0, 0, 1, -10)
    headerFix.BackgroundColor3 = Theme.Header
    headerFix.BorderSizePixel = 0
    headerFix.Parent = self.HeaderBar

    -- Logo Icon (square placeholder)
    local logoIcon = Instance.new('Frame')
    logoIcon.Name = 'LogoIcon'
    logoIcon.Size = UDim2.new(0, 20, 0, 20)
    logoIcon.Position = UDim2.new(0.5, -70, 0.5, -10)
    logoIcon.BackgroundColor3 = Theme.Accent
    logoIcon.BorderSizePixel = 0
    logoIcon.Parent = self.HeaderBar

    local logoCorner = Instance.new('UICorner')
    logoCorner.CornerRadius = UDim.new(0, 4)
    logoCorner.Parent = logoIcon

    -- Title Text
    local titleText = Instance.new('TextLabel')
    titleText.Name = 'Title'
    titleText.Size = UDim2.new(0, 100, 0, 20)
    titleText.Position = UDim2.new(0.5, -40, 0.5, -10)
    titleText.BackgroundTransparency = 1
    titleText.Text = self.WindowName
    titleText.TextColor3 = Theme.Text
    titleText.TextSize = 16
    titleText.Font = Enum.Font.GothamBold
    titleText.Parent = self.HeaderBar

    -- Version Badge
    local versionBadge = Instance.new('Frame')
    versionBadge.Name = 'VersionBadge'
    versionBadge.Size = UDim2.new(0, 36, 0, 18)
    versionBadge.Position = UDim2.new(0.5, 45, 0.5, -9)
    versionBadge.BackgroundColor3 = Theme.Element
    versionBadge.BorderSizePixel = 0
    versionBadge.Parent = self.HeaderBar

    local versionCorner = Instance.new('UICorner')
    versionCorner.CornerRadius = UDim.new(0, 9)
    versionCorner.Parent = versionBadge

    local versionText = Instance.new('TextLabel')
    versionText.Size = UDim2.new(1, 0, 1, 0)
    versionText.BackgroundTransparency = 1
    versionText.Text = self.Version
    versionText.TextColor3 = Theme.TextDim
    versionText.TextSize = 11
    versionText.Font = Enum.Font.Gotham
    versionText.Parent = versionBadge

    -- Theme Toggle Button (moon icon placeholder)
    local themeButton = Instance.new('TextButton')
    themeButton.Name = 'ThemeButton'
    themeButton.Size = UDim2.new(0, 36, 0, 36)
    themeButton.Position = UDim2.new(1, -50, 0.5, -18)
    themeButton.BackgroundColor3 = Theme.Element
    themeButton.BorderSizePixel = 0
    themeButton.Text = 'C'
    themeButton.TextColor3 = Theme.TextDim
    themeButton.TextSize = 14
    themeButton.Font = Enum.Font.Gotham
    themeButton.AutoButtonColor = false
    themeButton.Parent = self.HeaderBar

    local themeCorner = Instance.new('UICorner')
    themeCorner.CornerRadius = UDim.new(0, 8)
    themeCorner.Parent = themeButton

    themeButton.MouseEnter:Connect(function()
        TweenService:Create(themeButton, TweenInfo.new(0.2), {BackgroundColor3 = Theme.ElementHover}):Play()
    end)
    themeButton.MouseLeave:Connect(function()
        TweenService:Create(themeButton, TweenInfo.new(0.2), {BackgroundColor3 = Theme.Element}):Play()
    end)

    -- Sidebar
    self.Sidebar = Instance.new('Frame')
    self.Sidebar.Name = 'Sidebar'
    self.Sidebar.Size = UDim2.new(0, 180, 1, -50)
    self.Sidebar.Position = UDim2.new(0, 0, 0, 50)
    self.Sidebar.BackgroundColor3 = Theme.Sidebar
    self.Sidebar.BorderSizePixel = 0
    self.Sidebar.Parent = self.MainFrame

    -- Navigation Label
    local navLabel = Instance.new('TextLabel')
    navLabel.Name = 'NavigationLabel'
    navLabel.Size = UDim2.new(1, -30, 0, 20)
    navLabel.Position = UDim2.new(0, 15, 0, 15)
    navLabel.BackgroundTransparency = 1
    navLabel.Text = 'NAVIGATION'
    navLabel.TextColor3 = Theme.TextMuted
    navLabel.TextSize = 10
    navLabel.Font = Enum.Font.GothamBold
    navLabel.TextXAlignment = Enum.TextXAlignment.Left
    navLabel.Parent = self.Sidebar

    -- Tab Container
    self.TabContainer = Instance.new('ScrollingFrame')
    self.TabContainer.Name = 'TabContainer'
    self.TabContainer.Size = UDim2.new(1, -20, 1, -50)
    self.TabContainer.Position = UDim2.new(0, 10, 0, 40)
    self.TabContainer.BackgroundTransparency = 1
    self.TabContainer.BorderSizePixel = 0
    self.TabContainer.ScrollBarThickness = 3
    self.TabContainer.ScrollBarImageColor3 = Theme.Accent
    self.TabContainer.Parent = self.Sidebar

    local tabLayout = Instance.new('UIListLayout')
    tabLayout.Padding = UDim.new(0, 4)
    tabLayout.SortOrder = Enum.SortOrder.LayoutOrder
    tabLayout.Parent = self.TabContainer

    -- Content Area
    self.ContentContainer = Instance.new('Frame')
    self.ContentContainer.Name = 'ContentContainer'
    self.ContentContainer.Size = UDim2.new(1, -180, 1, -50)
    self.ContentContainer.Position = UDim2.new(0, 180, 0, 50)
    self.ContentContainer.BackgroundColor3 = Theme.Background
    self.ContentContainer.BorderSizePixel = 0
    self.ContentContainer.ClipsDescendants = true
    self.ContentContainer.Parent = self.MainFrame

    self:MakeDraggable(self.HeaderBar)
end

function VNDevUI:MakeDraggable(frame)
    local dragging = false
    local dragInput, mousePos, framePos

    frame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            mousePos = input.Position
            framePos = self.MainFrame.Position

            input.Changed:Connect(function()
                if input.UserInputState == Enum.UserInputState.End then
                    dragging = false
                end
            end)
        end
    end)

    frame.InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement then
            dragInput = input
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if input == dragInput and dragging then
            local delta = input.Position - mousePos
            self.MainFrame.Position = UDim2.new(
                framePos.X.Scale,
                framePos.X.Offset + delta.X,
                framePos.Y.Scale,
                framePos.Y.Offset + delta.Y
            )
        end
    end)
end

function VNDevUI:BindToggleKey()
    UserInputService.InputBegan:Connect(function(input, gameProcessed)
        if gameProcessed then return end
        if input.KeyCode == Enum.KeyCode.K then
            self:ToggleUI()
        end
    end)
end

function VNDevUI:ToggleUI()
    self.MainFrame.Visible = not self.MainFrame.Visible
end

function VNDevUI:Notify(title, text)
    pcall(function()
        game.StarterGui:SetCore("SendNotification", {
            Title = title,
            Text = text,
            Duration = 3,
        })
    end)
end

-- Tab Icons (simple text representations)
local TabIcons = {
    Config = "O",
    AHK = "[]",
    Testing = "+",
    About = "()",
    Settings = "O",
    Main = "[]",
    Aimbot = "+",
    Visuals = "()",
}

function VNDevUI:CreateTab(tabName, icon)
    local tab = {
        Name = tabName,
        Elements = {},
        Sections = {},
    }

    local tabButton = Instance.new('TextButton')
    tabButton.Name = tabName
    tabButton.Size = UDim2.new(1, 0, 0, 38)
    tabButton.BackgroundColor3 = Theme.TabInactive
    tabButton.BorderSizePixel = 0
    tabButton.AutoButtonColor = false
    tabButton.Text = ''
    tabButton.LayoutOrder = #self.TabOrder + 1
    tabButton.Parent = self.TabContainer

    local tabCorner = Instance.new('UICorner')
    tabCorner.CornerRadius = UDim.new(0, 6)
    tabCorner.Parent = tabButton

    -- Left accent bar (shown when active)
    local accentBar = Instance.new('Frame')
    accentBar.Name = 'AccentBar'
    accentBar.Size = UDim2.new(0, 3, 0.6, 0)
    accentBar.Position = UDim2.new(0, 0, 0.2, 0)
    accentBar.BackgroundColor3 = Theme.Text
    accentBar.BorderSizePixel = 0
    accentBar.Visible = false
    accentBar.Parent = tabButton

    local accentCorner = Instance.new('UICorner')
    accentCorner.CornerRadius = UDim.new(0, 2)
    accentCorner.Parent = accentBar

    -- Icon
    local tabIcon = Instance.new('TextLabel')
    tabIcon.Name = 'Icon'
    tabIcon.Size = UDim2.new(0, 24, 0, 24)
    tabIcon.Position = UDim2.new(0, 12, 0.5, -12)
    tabIcon.BackgroundTransparency = 1
    tabIcon.Text = icon or TabIcons[tabName] or "O"
    tabIcon.TextColor3 = Theme.TextDim
    tabIcon.TextSize = 14
    tabIcon.Font = Enum.Font.GothamBold
    tabIcon.Parent = tabButton

    -- Tab Name
    local tabText = Instance.new('TextLabel')
    tabText.Name = 'TabName'
    tabText.Size = UDim2.new(1, -50, 1, 0)
    tabText.Position = UDim2.new(0, 42, 0, 0)
    tabText.BackgroundTransparency = 1
    tabText.Text = tabName
    tabText.TextColor3 = Theme.TextDim
    tabText.TextSize = 13
    tabText.Font = Enum.Font.Gotham
    tabText.TextXAlignment = Enum.TextXAlignment.Left
    tabText.Parent = tabButton

    -- Content Frame
    local tabFrame = Instance.new('ScrollingFrame')
    tabFrame.Name = tabName
    tabFrame.Size = UDim2.new(1, -30, 1, -30)
    tabFrame.Position = UDim2.new(0, 15, 0, 15)
    tabFrame.BackgroundTransparency = 1
    tabFrame.BorderSizePixel = 0
    tabFrame.ScrollBarThickness = 4
    tabFrame.ScrollBarImageColor3 = Theme.Accent
    tabFrame.CanvasSize = UDim2.new(0, 0, 0, 0)
    tabFrame.Visible = false
    tabFrame.Parent = self.ContentContainer

    local layout = Instance.new('UIListLayout')
    layout.Padding = UDim.new(0, 12)
    layout.SortOrder = Enum.SortOrder.LayoutOrder
    layout.Parent = tabFrame

    layout:GetPropertyChangedSignal('AbsoluteContentSize'):Connect(function()
        tabFrame.CanvasSize = UDim2.new(0, 0, 0, layout.AbsoluteContentSize.Y + 20)
    end)

    tabButton.MouseEnter:Connect(function()
        if self.CurrentTab ~= tabName then
            TweenService:Create(tabButton, TweenInfo.new(0.15), {BackgroundColor3 = Theme.ElementHover}):Play()
        end
    end)

    tabButton.MouseLeave:Connect(function()
        if self.CurrentTab ~= tabName then
            TweenService:Create(tabButton, TweenInfo.new(0.15), {BackgroundColor3 = Theme.TabInactive}):Play()
        end
    end)

    tabButton.MouseButton1Click:Connect(function()
        self:SwitchTab(tabName)
    end)

    tab.Button = tabButton
    tab.Frame = tabFrame
    tab.Icon = tabIcon
    tab.Text = tabText
    tab.AccentBar = accentBar
    tab.Layout = layout
    self.Tabs[tabName] = tab
    table.insert(self.TabOrder, tabName)

    self.TabContainer.CanvasSize = UDim2.new(0, 0, 0, #self.TabOrder * 42 + 10)

    if not self.CurrentTab then
        self:SwitchTab(tabName)
    end

    return tab
end

function VNDevUI:SwitchTab(tabName)
    for name, tab in pairs(self.Tabs) do
        tab.Frame.Visible = false
        tab.AccentBar.Visible = false
        TweenService:Create(tab.Button, TweenInfo.new(0.15), {BackgroundColor3 = Theme.TabInactive}):Play()
        TweenService:Create(tab.Text, TweenInfo.new(0.15), {TextColor3 = Theme.TextDim}):Play()
        TweenService:Create(tab.Icon, TweenInfo.new(0.15), {TextColor3 = Theme.TextDim}):Play()
    end

    if self.Tabs[tabName] then
        self.Tabs[tabName].Frame.Visible = true
        self.Tabs[tabName].AccentBar.Visible = true
        TweenService:Create(self.Tabs[tabName].Button, TweenInfo.new(0.15), {BackgroundColor3 = Theme.TabActive}):Play()
        TweenService:Create(self.Tabs[tabName].Text, TweenInfo.new(0.15), {TextColor3 = Theme.Text}):Play()
        TweenService:Create(self.Tabs[tabName].Icon, TweenInfo.new(0.15), {TextColor3 = Theme.Text}):Play()
        self.CurrentTab = tabName
    end
end

-- Create a Section Header (like "General Settings" in the screenshot)
function VNDevUI:CreateSection(tab, sectionName)
    local sectionFrame = Instance.new('Frame')
    sectionFrame.Name = sectionName
    sectionFrame.Size = UDim2.new(1, 0, 0, 40)
    sectionFrame.BackgroundColor3 = Theme.Element
    sectionFrame.BorderSizePixel = 0
    sectionFrame.LayoutOrder = #tab.Elements + 1
    sectionFrame.Parent = tab.Frame

    local sectionCorner = Instance.new('UICorner')
    sectionCorner.CornerRadius = UDim.new(0, 8)
    sectionCorner.Parent = sectionFrame

    -- Settings Icon
    local iconFrame = Instance.new('Frame')
    iconFrame.Size = UDim2.new(0, 28, 0, 28)
    iconFrame.Position = UDim2.new(0, 10, 0.5, -14)
    iconFrame.BackgroundColor3 = Theme.Accent
    iconFrame.BorderSizePixel = 0
    iconFrame.Parent = sectionFrame

    local iconCorner = Instance.new('UICorner')
    iconCorner.CornerRadius = UDim.new(0, 6)
    iconCorner.Parent = iconFrame

    local iconText = Instance.new('TextLabel')
    iconText.Size = UDim2.new(1, 0, 1, 0)
    iconText.BackgroundTransparency = 1
    iconText.Text = 'O'
    iconText.TextColor3 = Theme.TextDim
    iconText.TextSize = 14
    iconText.Font = Enum.Font.GothamBold
    iconText.Parent = iconFrame

    -- Section Title
    local sectionTitle = Instance.new('TextLabel')
    sectionTitle.Size = UDim2.new(1, -60, 1, 0)
    sectionTitle.Position = UDim2.new(0, 48, 0, 0)
    sectionTitle.BackgroundTransparency = 1
    sectionTitle.Text = sectionName
    sectionTitle.TextColor3 = Theme.Text
    sectionTitle.TextSize = 14
    sectionTitle.Font = Enum.Font.GothamMedium
    sectionTitle.TextXAlignment = Enum.TextXAlignment.Left
    sectionTitle.Parent = sectionFrame

    table.insert(tab.Elements, sectionFrame)
    return sectionFrame
end

-- Create a Title Header (like "Configuration" with subtitle)
function VNDevUI:CreateHeader(tab, title, subtitle)
    local headerFrame = Instance.new('Frame')
    headerFrame.Name = 'Header'
    headerFrame.Size = UDim2.new(1, 0, 0, 50)
    headerFrame.BackgroundTransparency = 1
    headerFrame.LayoutOrder = #tab.Elements + 1
    headerFrame.Parent = tab.Frame

    local titleLabel = Instance.new('TextLabel')
    titleLabel.Size = UDim2.new(1, 0, 0, 24)
    titleLabel.Position = UDim2.new(0, 0, 0, 0)
    titleLabel.BackgroundTransparency = 1
    titleLabel.Text = title
    titleLabel.TextColor3 = Theme.Text
    titleLabel.TextSize = 20
    titleLabel.Font = Enum.Font.GothamBold
    titleLabel.TextXAlignment = Enum.TextXAlignment.Left
    titleLabel.Parent = headerFrame

    if subtitle then
        local subtitleLabel = Instance.new('TextLabel')
        subtitleLabel.Size = UDim2.new(1, 0, 0, 16)
        subtitleLabel.Position = UDim2.new(0, 0, 0, 26)
        subtitleLabel.BackgroundTransparency = 1
        subtitleLabel.Text = subtitle
        subtitleLabel.TextColor3 = Theme.TextMuted
        subtitleLabel.TextSize = 12
        subtitleLabel.Font = Enum.Font.Gotham
        subtitleLabel.TextXAlignment = Enum.TextXAlignment.Left
        subtitleLabel.Parent = headerFrame
    end

    table.insert(tab.Elements, headerFrame)
    return headerFrame
end

function VNDevUI:CreateToggle(tab, config)
    local toggleFrame = Instance.new('Frame')
    toggleFrame.Name = config.Name
    toggleFrame.Size = UDim2.new(1, 0, 0, 50)
    toggleFrame.BackgroundColor3 = Theme.Element
    toggleFrame.BorderSizePixel = 0
    toggleFrame.LayoutOrder = #tab.Elements + 1
    toggleFrame.Parent = tab.Frame

    local corner = Instance.new('UICorner')
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = toggleFrame

    -- Left accent bar
    local leftBar = Instance.new('Frame')
    leftBar.Size = UDim2.new(0, 3, 0.5, 0)
    leftBar.Position = UDim2.new(0, 0, 0.25, 0)
    leftBar.BackgroundColor3 = Theme.Accent
    leftBar.BorderSizePixel = 0
    leftBar.Parent = toggleFrame

    local barCorner = Instance.new('UICorner')
    barCorner.CornerRadius = UDim.new(0, 2)
    barCorner.Parent = leftBar

    local label = Instance.new('TextLabel')
    label.Name = 'Label'
    label.Size = UDim2.new(0.7, -20, 1, 0)
    label.Position = UDim2.new(0, 18, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = config.Name
    label.TextColor3 = Theme.Text
    label.TextSize = 13
    label.Font = Enum.Font.Gotham
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = toggleFrame

    -- Toggle Switch
    local toggleButton = Instance.new('TextButton')
    toggleButton.Name = 'Toggle'
    toggleButton.Size = UDim2.new(0, 44, 0, 24)
    toggleButton.Position = UDim2.new(1, -58, 0.5, -12)
    toggleButton.BackgroundColor3 = Theme.Toggle
    toggleButton.BorderSizePixel = 0
    toggleButton.Text = ''
    toggleButton.AutoButtonColor = false
    toggleButton.Parent = toggleFrame

    local toggleCorner = Instance.new('UICorner')
    toggleCorner.CornerRadius = UDim.new(1, 0)
    toggleCorner.Parent = toggleButton

    local toggleCircle = Instance.new('Frame')
    toggleCircle.Size = UDim2.new(0, 18, 0, 18)
    toggleCircle.Position = UDim2.new(0, 3, 0.5, -9)
    toggleCircle.BackgroundColor3 = Theme.TextDim
    toggleCircle.BorderSizePixel = 0
    toggleCircle.Parent = toggleButton

    local circleCorner = Instance.new('UICorner')
    circleCorner.CornerRadius = UDim.new(1, 0)
    circleCorner.Parent = toggleCircle

    local toggleState = config.CurrentValue or false
    local settingId = config.Flag or config.Name
    
    self.Settings[settingId] = {
        Type = "Toggle",
        Value = toggleState,
        Element = toggleFrame,
        Set = nil
    }

    local function updateToggle(animate)
        if animate == nil then animate = true end
        local info = TweenInfo.new(0.2)

        if toggleState then
            if animate then
                TweenService:Create(toggleButton, info, {BackgroundColor3 = Theme.ToggleEnabled}):Play()
                TweenService:Create(toggleCircle, info, {Position = UDim2.new(1, -21, 0.5, -9), BackgroundColor3 = Theme.Text}):Play()
            else
                toggleButton.BackgroundColor3 = Theme.ToggleEnabled
                toggleCircle.Position = UDim2.new(1, -21, 0.5, -9)
                toggleCircle.BackgroundColor3 = Theme.Text
            end
        else
            if animate then
                TweenService:Create(toggleButton, info, {BackgroundColor3 = Theme.Toggle}):Play()
                TweenService:Create(toggleCircle, info, {Position = UDim2.new(0, 3, 0.5, -9), BackgroundColor3 = Theme.TextDim}):Play()
            else
                toggleButton.BackgroundColor3 = Theme.Toggle
                toggleCircle.Position = UDim2.new(0, 3, 0.5, -9)
                toggleCircle.BackgroundColor3 = Theme.TextDim
            end
        end
        
        self.Settings[settingId].Value = toggleState
    end

    updateToggle(false)

    toggleButton.MouseButton1Click:Connect(function()
        toggleState = not toggleState
        updateToggle(true)
        if config.Callback then
            config.Callback(toggleState)
        end
    end)

    table.insert(tab.Elements, toggleFrame)
    
    local returnTable = {
        Set = function(value)
            toggleState = value
            updateToggle(true)
            self.Settings[settingId].Value = value
        end,
        Get = function()
            return toggleState
        end,
    }
    
    self.Settings[settingId].Set = returnTable.Set
    return returnTable
end

function VNDevUI:CreateKeybind(tab, config)
    local keybindFrame = Instance.new('Frame')
    keybindFrame.Name = config.Name
    keybindFrame.Size = UDim2.new(1, 0, 0, 50)
    keybindFrame.BackgroundColor3 = Theme.Element
    keybindFrame.BorderSizePixel = 0
    keybindFrame.LayoutOrder = #tab.Elements + 1
    keybindFrame.Parent = tab.Frame

    local corner = Instance.new('UICorner')
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = keybindFrame

    -- Label section
    local labelSection = Instance.new('Frame')
    labelSection.Size = UDim2.new(0.5, 0, 1, 0)
    labelSection.BackgroundTransparency = 1
    labelSection.Parent = keybindFrame

    local labelTitle = Instance.new('TextLabel')
    labelTitle.Size = UDim2.new(1, -20, 0, 14)
    labelTitle.Position = UDim2.new(0, 15, 0, 10)
    labelTitle.BackgroundTransparency = 1
    labelTitle.Text = config.Label or 'ACTIVATION KEYBIND'
    labelTitle.TextColor3 = Theme.TextMuted
    labelTitle.TextSize = 10
    labelTitle.Font = Enum.Font.GothamBold
    labelTitle.TextXAlignment = Enum.TextXAlignment.Left
    labelTitle.Parent = labelSection

    -- Keybind button
    local keybindButton = Instance.new('TextButton')
    keybindButton.Size = UDim2.new(0, 60, 0, 28)
    keybindButton.Position = UDim2.new(0, 15, 0, 26)
    keybindButton.BackgroundColor3 = Theme.Keybind
    keybindButton.BorderSizePixel = 0
    keybindButton.Text = config.CurrentValue and config.CurrentValue.Name or 'NONE'
    keybindButton.TextColor3 = Theme.Text
    keybindButton.TextSize = 11
    keybindButton.Font = Enum.Font.GothamBold
    keybindButton.AutoButtonColor = false
    keybindButton.Parent = labelSection

    local keybindCorner = Instance.new('UICorner')
    keybindCorner.CornerRadius = UDim.new(0, 6)
    keybindCorner.Parent = keybindButton

    local clickHint = Instance.new('TextLabel')
    clickHint.Size = UDim2.new(0, 100, 0, 28)
    clickHint.Position = UDim2.new(0, 85, 0, 26)
    clickHint.BackgroundTransparency = 1
    clickHint.Text = 'Click to change'
    clickHint.TextColor3 = Theme.TextMuted
    clickHint.TextSize = 11
    clickHint.Font = Enum.Font.Gotham
    clickHint.TextXAlignment = Enum.TextXAlignment.Left
    clickHint.Parent = labelSection

    local currentKey = config.CurrentValue
    local listening = false
    local settingId = config.Flag or config.Name
    
    self.Settings[settingId] = {
        Type = "Keybind",
        Value = currentKey,
        Element = keybindFrame,
        Set = nil
    }

    keybindButton.MouseButton1Click:Connect(function()
        if listening then return end
        listening = true
        keybindButton.Text = '...'
        
        local conn
        conn = UserInputService.InputBegan:Connect(function(input, processed)
            if input.UserInputType == Enum.UserInputType.Keyboard then
                currentKey = input.KeyCode
                keybindButton.Text = currentKey.Name
                self.Settings[settingId].Value = currentKey
                listening = false
                conn:Disconnect()
                if config.Callback then
                    config.Callback(currentKey)
                end
            end
        end)
    end)

    table.insert(tab.Elements, keybindFrame)
    
    local returnTable = {
        Set = function(value)
            currentKey = value
            keybindButton.Text = value and value.Name or 'NONE'
            self.Settings[settingId].Value = value
        end,
        Get = function()
            return currentKey
        end,
    }
    
    self.Settings[settingId].Set = returnTable.Set
    return returnTable
end

function VNDevUI:CreateSlider(tab, config)
    local sliderFrame = Instance.new('Frame')
    sliderFrame.Name = config.Name
    sliderFrame.Size = UDim2.new(1, 0, 0, 55)
    sliderFrame.BackgroundColor3 = Theme.Element
    sliderFrame.BorderSizePixel = 0
    sliderFrame.LayoutOrder = #tab.Elements + 1
    sliderFrame.Parent = tab.Frame

    local corner = Instance.new('UICorner')
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = sliderFrame

    -- Label
    local labelTitle = Instance.new('TextLabel')
    labelTitle.Size = UDim2.new(1, -20, 0, 14)
    labelTitle.Position = UDim2.new(0, 15, 0, 8)
    labelTitle.BackgroundTransparency = 1
    labelTitle.Text = config.Label or config.Name:upper()
    labelTitle.TextColor3 = Theme.TextMuted
    labelTitle.TextSize = 10
    labelTitle.Font = Enum.Font.GothamBold
    labelTitle.TextXAlignment = Enum.TextXAlignment.Left
    labelTitle.Parent = sliderFrame

    -- Value Display
    local valueBox = Instance.new('Frame')
    valueBox.Size = UDim2.new(0.3, -20, 0, 28)
    valueBox.Position = UDim2.new(0.7, 5, 0, 22)
    valueBox.BackgroundColor3 = Theme.Input
    valueBox.BorderSizePixel = 0
    valueBox.Parent = sliderFrame

    local valueCorner = Instance.new('UICorner')
    valueCorner.CornerRadius = UDim.new(0, 6)
    valueCorner.Parent = valueBox

    local valueLabel = Instance.new('TextLabel')
    valueLabel.Size = UDim2.new(1, 0, 1, 0)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = tostring(config.CurrentValue or config.Range[1])
    valueLabel.TextColor3 = Theme.Text
    valueLabel.TextSize = 13
    valueLabel.Font = Enum.Font.GothamMedium
    valueLabel.Parent = valueBox

    local currentValue = config.CurrentValue or config.Range[1]
    local range = config.Range[2] - config.Range[1]
    local settingId = config.Flag or config.Name
    
    self.Settings[settingId] = {
        Type = "Slider",
        Value = currentValue,
        Element = sliderFrame,
        Set = nil
    }

    local function formatValue(value)
        if config.Increment and config.Increment < 1 then
            return math.floor(value * 10 + 0.5) / 10
        else
            return math.floor(value + 0.5)
        end
    end

    local function updateValue(value)
        currentValue = math.clamp(value, config.Range[1], config.Range[2])
        if config.Increment then
            currentValue = math.floor(currentValue / config.Increment + 0.5) * config.Increment
        end
        currentValue = formatValue(currentValue)
        valueLabel.Text = tostring(currentValue) .. (config.Suffix or '')
        self.Settings[settingId].Value = currentValue
        if config.Callback then
            config.Callback(currentValue)
        end
    end

    updateValue(currentValue)

    -- Make value box clickable to type
    local valueInput = Instance.new('TextBox')
    valueInput.Size = UDim2.new(1, 0, 1, 0)
    valueInput.BackgroundTransparency = 1
    valueInput.Text = ''
    valueInput.PlaceholderText = ''
    valueInput.TextTransparency = 1
    valueInput.Parent = valueBox

    valueInput.FocusLost:Connect(function(enterPressed)
        local num = tonumber(valueInput.Text)
        if num then
            updateValue(num)
        end
        valueInput.Text = ''
    end)

    table.insert(tab.Elements, sliderFrame)
    
    local returnTable = {
        Set = function(value)
            updateValue(value)
        end,
        Get = function()
            return currentValue
        end,
    }
    
    self.Settings[settingId].Set = returnTable.Set
    return returnTable
end

-- HSV Color Slider (like in the screenshot)
function VNDevUI:CreateHSVSlider(tab, config)
    local hsvFrame = Instance.new('Frame')
    hsvFrame.Name = config.Name
    hsvFrame.Size = UDim2.new(0.48, 0, 0, 75)
    hsvFrame.BackgroundTransparency = 1
    hsvFrame.LayoutOrder = #tab.Elements + 1
    hsvFrame.Parent = tab.Frame

    -- Label with color indicator
    local labelContainer = Instance.new('Frame')
    labelContainer.Size = UDim2.new(1, 0, 0, 16)
    labelContainer.BackgroundTransparency = 1
    labelContainer.Parent = hsvFrame

    local colorDot = Instance.new('Frame')
    colorDot.Size = UDim2.new(0, 10, 0, 10)
    colorDot.Position = UDim2.new(0, 0, 0.5, -5)
    colorDot.BackgroundColor3 = Color3.fromHSV((config.CurrentValue or 0) / 360, 1, 1)
    colorDot.BorderSizePixel = 0
    colorDot.Parent = labelContainer

    local dotCorner = Instance.new('UICorner')
    dotCorner.CornerRadius = UDim.new(1, 0)
    dotCorner.Parent = colorDot

    local label = Instance.new('TextLabel')
    label.Size = UDim2.new(1, -18, 1, 0)
    label.Position = UDim2.new(0, 18, 0, 0)
    label.BackgroundTransparency = 1
    label.Text = config.Label or config.Name
    label.TextColor3 = Theme.TextMuted
    label.TextSize = 10
    label.Font = Enum.Font.GothamBold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = labelContainer

    -- Slider and Value container
    local sliderContainer = Instance.new('Frame')
    sliderContainer.Size = UDim2.new(1, 0, 0, 32)
    sliderContainer.Position = UDim2.new(0, 0, 0, 24)
    sliderContainer.BackgroundTransparency = 1
    sliderContainer.Parent = hsvFrame

    -- Rainbow slider track
    local sliderTrack = Instance.new('Frame')
    sliderTrack.Size = UDim2.new(0.55, 0, 0, 28)
    sliderTrack.BackgroundColor3 = Color3.new(1, 1, 1)
    sliderTrack.BorderSizePixel = 0
    sliderTrack.Parent = sliderContainer

    local trackCorner = Instance.new('UICorner')
    trackCorner.CornerRadius = UDim.new(0, 6)
    trackCorner.Parent = sliderTrack

    -- Create rainbow gradient
    local gradient = Instance.new('UIGradient')
    gradient.Color = ColorSequence.new({
        ColorSequenceKeypoint.new(0, Color3.fromHSV(0, 1, 1)),
        ColorSequenceKeypoint.new(0.17, Color3.fromHSV(0.17, 1, 1)),
        ColorSequenceKeypoint.new(0.33, Color3.fromHSV(0.33, 1, 1)),
        ColorSequenceKeypoint.new(0.5, Color3.fromHSV(0.5, 1, 1)),
        ColorSequenceKeypoint.new(0.67, Color3.fromHSV(0.67, 1, 1)),
        ColorSequenceKeypoint.new(0.83, Color3.fromHSV(0.83, 1, 1)),
        ColorSequenceKeypoint.new(1, Color3.fromHSV(1, 1, 1)),
    })
    gradient.Parent = sliderTrack

    -- Slider knob
    local sliderKnob = Instance.new('Frame')
    sliderKnob.Size = UDim2.new(0, 18, 0, 18)
    sliderKnob.Position = UDim2.new(0, 0, 0.5, -9)
    sliderKnob.BackgroundColor3 = Color3.new(1, 1, 1)
    sliderKnob.BorderSizePixel = 0
    sliderKnob.ZIndex = 2
    sliderKnob.Parent = sliderTrack

    local knobCorner = Instance.new('UICorner')
    knobCorner.CornerRadius = UDim.new(1, 0)
    knobCorner.Parent = sliderKnob

    local knobStroke = Instance.new('UIStroke')
    knobStroke.Color = Color3.fromRGB(60, 60, 70)
    knobStroke.Thickness = 2
    knobStroke.Parent = sliderKnob

    -- Value box
    local valueBox = Instance.new('Frame')
    valueBox.Size = UDim2.new(0.42, -5, 0, 28)
    valueBox.Position = UDim2.new(0.58, 5, 0, 0)
    valueBox.BackgroundColor3 = Theme.Input
    valueBox.BorderSizePixel = 0
    valueBox.Parent = sliderContainer

    local valueCorner = Instance.new('UICorner')
    valueCorner.CornerRadius = UDim.new(0, 6)
    valueCorner.Parent = valueBox

    local valueLabel = Instance.new('TextLabel')
    valueLabel.Size = UDim2.new(1, 0, 1, 0)
    valueLabel.BackgroundTransparency = 1
    valueLabel.Text = tostring(config.CurrentValue or 0)
    valueLabel.TextColor3 = Theme.Text
    valueLabel.TextSize = 13
    valueLabel.Font = Enum.Font.GothamMedium
    valueLabel.Parent = valueBox

    local currentValue = config.CurrentValue or 0
    local settingId = config.Flag or config.Name
    
    self.Settings[settingId] = {
        Type = "HSVSlider",
        Value = currentValue,
        Element = hsvFrame,
        Set = nil
    }

    local function updateSlider(value)
        currentValue = math.clamp(value, 0, 360)
        currentValue = math.floor(currentValue + 0.5)
        local percentage = currentValue / 360
        sliderKnob.Position = UDim2.new(percentage, -9, 0.5, -9)
        valueLabel.Text = tostring(currentValue)
        colorDot.BackgroundColor3 = Color3.fromHSV(currentValue / 360, 1, 1)
        self.Settings[settingId].Value = currentValue
        if config.Callback then
            config.Callback(currentValue)
        end
    end

    updateSlider(currentValue)

    local dragging = false
    
    sliderTrack.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = true
            local percentage = math.clamp((input.Position.X - sliderTrack.AbsolutePosition.X) / sliderTrack.AbsoluteSize.X, 0, 1)
            updateSlider(percentage * 360)
        end
    end)

    UserInputService.InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 then
            dragging = false
        end
    end)

    UserInputService.InputChanged:Connect(function(input)
        if dragging and input.UserInputType == Enum.UserInputType.MouseMovement then
            local percentage = math.clamp((input.Position.X - sliderTrack.AbsolutePosition.X) / sliderTrack.AbsoluteSize.X, 0, 1)
            updateSlider(percentage * 360)
        end
    end)

    table.insert(tab.Elements, hsvFrame)
    
    local returnTable = {
        Set = function(value)
            updateSlider(value)
        end,
        Get = function()
            return currentValue
        end,
    }
    
    self.Settings[settingId].Set = returnTable.Set
    return returnTable
end

-- Two column layout container for HSV sliders
function VNDevUI:CreateTwoColumn(tab)
    local container = Instance.new('Frame')
    container.Name = 'TwoColumnContainer'
    container.Size = UDim2.new(1, 0, 0, 75)
    container.BackgroundTransparency = 1
    container.LayoutOrder = #tab.Elements + 1
    container.Parent = tab.Frame

    table.insert(tab.Elements, container)
    
    return {
        Frame = container,
        Left = function(self)
            return container
        end,
        Right = function(self)
            return container
        end
    }
end

function VNDevUI:CreateButton(tab, config)
    local button = Instance.new('TextButton')
    button.Name = config.Name
    button.Size = UDim2.new(1, 0, 0, 42)
    button.BackgroundColor3 = Theme.Element
    button.BorderSizePixel = 0
    button.AutoButtonColor = false
    button.Text = config.Name
    button.TextColor3 = Theme.Text
    button.TextSize = 13
    button.Font = Enum.Font.GothamMedium
    button.LayoutOrder = #tab.Elements + 1
    button.Parent = tab.Frame

    local corner = Instance.new('UICorner')
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = button

    button.MouseEnter:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.15), {BackgroundColor3 = Theme.ElementHover}):Play()
    end)

    button.MouseLeave:Connect(function()
        TweenService:Create(button, TweenInfo.new(0.15), {BackgroundColor3 = Theme.Element}):Play()
    end)

    button.MouseButton1Click:Connect(function()
        if config.Callback then
            config.Callback()
        end
    end)

    table.insert(tab.Elements, button)
    return button
end

function VNDevUI:CreateTextbox(tab, config)
    local inputFrame = Instance.new('Frame')
    inputFrame.Name = config.Name
    inputFrame.Size = UDim2.new(1, 0, 0, 50)
    inputFrame.BackgroundColor3 = Theme.Element
    inputFrame.BorderSizePixel = 0
    inputFrame.LayoutOrder = #tab.Elements + 1
    inputFrame.Parent = tab.Frame

    local corner = Instance.new('UICorner')
    corner.CornerRadius = UDim.new(0, 8)
    corner.Parent = inputFrame

    local label = Instance.new('TextLabel')
    label.Size = UDim2.new(1, -20, 0, 14)
    label.Position = UDim2.new(0, 15, 0, 8)
    label.BackgroundTransparency = 1
    label.Text = (config.Label or config.Name):upper()
    label.TextColor3 = Theme.TextMuted
    label.TextSize = 10
    label.Font = Enum.Font.GothamBold
    label.TextXAlignment = Enum.TextXAlignment.Left
    label.Parent = inputFrame

    local textBox = Instance.new('TextBox')
    textBox.Size = UDim2.new(1, -30, 0, 22)
    textBox.Position = UDim2.new(0, 15, 0, 24)
    textBox.BackgroundColor3 = Theme.Input
    textBox.BorderSizePixel = 0
    textBox.PlaceholderText = config.Placeholder or ''
    textBox.Text = config.CurrentValue or ''
    textBox.TextColor3 = Theme.Text
    textBox.PlaceholderColor3 = Theme.TextMuted
    textBox.TextSize = 12
    textBox.Font = Enum.Font.Gotham
    textBox.TextXAlignment = Enum.TextXAlignment.Left
    textBox.ClearTextOnFocus = false
    textBox.Parent = inputFrame

    local inputCorner = Instance.new('UICorner')
    inputCorner.CornerRadius = UDim.new(0, 4)
    inputCorner.Parent = textBox

    local inputPadding = Instance.new('UIPadding')
    inputPadding.PaddingLeft = UDim.new(0, 8)
    inputPadding.Parent = textBox

    local settingId = config.Flag or config.Name
    self.Settings[settingId] = {
        Type = "Textbox",
        Value = config.CurrentValue or '',
        Element = inputFrame,
        Set = nil
    }

    textBox.FocusLost:Connect(function()
        self.Settings[settingId].Value = textBox.Text
        if config.Callback then
            config.Callback(textBox.Text)
        end
    end)

    table.insert(tab.Elements, inputFrame)
    
    local returnTable = {
        Set = function(value)
            textBox.Text = value
            self.Settings[settingId].Value = value
        end,
        Get = function()
            return textBox.Text
        end,
    }
    
    self.Settings[settingId].Set = returnTable.Set
    return returnTable
end

function VNDevUI:CreateConfigSection(tab)
    self:CreateTextbox(tab, {
        Name = 'ConfigName',
        Label = 'CONFIG NAME',
        Placeholder = 'Enter config name...',
        Flag = 'ConfigNameInput'
    })

    self:CreateButton(tab, {
        Name = 'Save Config',
        Callback = function()
            local configName = self.Settings['ConfigNameInput'] and self.Settings['ConfigNameInput'].Value or ''
            if configName and configName ~= '' then
                local success = self.ConfigManager:SaveConfig(configName, self:GetCurrentSettings())
                if success then
                    self:Notify("Config Saved", "Saved as: " .. configName)
                else
                    self:Notify("Error", "Failed to save config")
                end
            else
                self:Notify("Error", "Please enter a config name")
            end
        end
    })

    self:CreateButton(tab, {
        Name = 'Load Config',
        Callback = function()
            local configName = self.Settings['ConfigNameInput'] and self.Settings['ConfigNameInput'].Value or ''
            if configName and configName ~= '' then
                local settings = self.ConfigManager:LoadConfig(configName)
                if settings then
                    self:ApplySettings(settings)
                    self:Notify("Config Loaded", "Loaded: " .. configName)
                else
                    self:Notify("Error", "Config not found")
                end
            else
                self:Notify("Error", "Please enter a config name")
            end
        end
    })

    self:CreateButton(tab, {
        Name = 'Delete Config',
        Callback = function()
            local configName = self.Settings['ConfigNameInput'] and self.Settings['ConfigNameInput'].Value or ''
            if configName and configName ~= '' then
                local success = self.ConfigManager:DeleteConfig(configName)
                if success then
                    self:Notify("Config Deleted", "Deleted: " .. configName)
                else
                    self:Notify("Error", "Failed to delete config")
                end
            else
                self:Notify("Error", "Please enter a config name")
            end
        end
    })

    self:CreateButton(tab, {
        Name = 'List Configs',
        Callback = function()
            local configs = self.ConfigManager:GetConfigs()
            if #configs > 0 then
                local configList = table.concat(configs, ", ")
                self:Notify("Available Configs", configList)
                print("Available Configs:", configList)
            else
                self:Notify("No Configs", "No saved configs found")
            end
        end
    })
end

function VNDevUI:GetCurrentSettings()
    local settings = {}
    for id, setting in pairs(self.Settings) do
        if id ~= 'ConfigNameInput' then
            settings[id] = setting.Value
        end
    end
    return settings
end

function VNDevUI:ApplySettings(settings)
    for id, value in pairs(settings) do
        if self.Settings[id] and self.Settings[id].Set then
            self.Settings[id].Set(value)
        end
    end
end

function VNDevUI:Destroy()
    if self.ScreenGui then
        self.ScreenGui:Destroy()
    end
end

return VNDevUI
